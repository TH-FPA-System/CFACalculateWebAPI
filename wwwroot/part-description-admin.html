<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Part Description Admin</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        body {
            font-family: Arial;
            padding: 16px;
        }

        textarea {
            width: 100%;
            min-height: 120px;
        }

        input {
            width: 100%;
            padding: 6px;
        }

        button {
            padding: 6px 12px;
            margin: 4px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }

        th, td {
            border: 1px solid #ccc;
            padding: 6px;
        }

        tr:hover {
            background: #f5f5f5;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <h2>Part Long Description Management</h2>

    <label>Part</label>
    <input id="partInput" placeholder="50250-BUG-CFA-RH-REV02">

    <label>Description</label>
<textarea id="descInput"></textarea>

    <button onclick="save()">💾 Save</button>
    <button onclick="clearForm()">➕ New</button>

    <hr>

    <input id="searchInput" placeholder="Search part..." oninput="load()">

    <table>
        <thead>
            <tr>
                <th>Part</th>
                <th>Description (preview)</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="tbody"></tbody>
    </table>

    <script>
const API = "/api/CFACal/PartDescription";

async function load() {
    const q = document.getElementById("searchInput").value;
    const res = await fetch(API + (q ? "?part=" + q : ""));
    const data = await res.json();

    const tbody = document.getElementById("tbody");
    tbody.innerHTML = "";

    data.forEach(d => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${d.part}</td>
            <td>${d.description_Long.substring(0, 40)}...</td>
            <td>
                <button onclick="edit('${d.part}')">✏️</button>
                <button onclick="del('${d.part}')">🗑</button>
            </td>`;
        tbody.appendChild(tr);
    });
}

async function edit(part) {
    const res = await fetch(API + "/" + part);
    const d = await res.json();
    partInput.value = d.part;
    descInput.value = d.description_Long;
}

async function save() {
    const payload = {
        part: partInput.value.trim(),
        description_Long: descInput.value
    };

    if (!payload.part) {
        alert("Part required");
        return;
    }

    await fetch(API, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
    });

    alert("Saved");
    clearForm();
    load();
}

async function del(part) {
    if (!confirm("Delete " + part + "?")) return;
    await fetch(API + "/" + part, { method: "DELETE" });
    load();
}

function clearForm() {
    partInput.value = "";
    descInput.value = "";
}

load();
    </script>

</body>
</html>
