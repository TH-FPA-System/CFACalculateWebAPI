<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Part Description Admin</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        :root {
            --primary: #2563eb;
            --danger: #dc2626;
            --bg: #f8fafc;
            --card: #ffffff;
            --border: #e5e7eb;
            --text: #1f2937;
            --muted: #6b7280;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            margin: 0;
            padding: 16px;
            color: var(--text);
        }

        h2 {
            margin-bottom: 12px;
        }

        .card {
            background: var(--card);
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.06);
            padding: 16px;
            margin-bottom: 16px;
        }

        label {
            font-weight: 600;
            font-size: 14px;
            display: block;
            margin-bottom: 4px;
            margin-top: 8px;
        }

        input, textarea {
            width: 100%;
            padding: 8px 10px;
            border-radius: 6px;
            border: 1px solid var(--border);
            font-size: 14px;
            box-sizing: border-box;
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        .btn-row {
            margin-top: 12px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        button {
            border: none;
            border-radius: 6px;
            padding: 8px 14px;
            font-size: 14px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-secondary {
            background: #e5e7eb;
            color: var(--text);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        button:hover {
            opacity: 0.9;
        }

        .search-box {
            margin-bottom: 8px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        thead {
            background: #f1f5f9;
        }

        th, td {
            padding: 8px;
            border-bottom: 1px solid var(--border);
            text-align: left;
            vertical-align: top;
        }

        tr:hover {
            background: #f8fafc;
        }

        .actions button {
            padding: 4px 8px;
            font-size: 13px;
        }

        .muted {
            color: var(--muted);
            font-size: 12px;
        }

        @media (max-width: 600px) {
            th:nth-child(2),
            td:nth-child(2) {
                display: none;
            }
        }
    </style>
</head>
<body>

    <h2>Part Long Description Management</h2>

    <!-- FORM -->
    <div class="card">
        <label>Part</label>
        <input id="partInput" placeholder="P/N">

        <label>Description</label>
        <textarea id="descInput" placeholder="Enter long description here..."></textarea>

        <div class="btn-row">
            <button class="btn-primary" onclick="save()">💾 Save</button>
            <button class="btn-secondary" onclick="clearForm()">➕ New</button>
        </div>
    </div>

    <!-- LIST -->
    <div class="card">
        <input id="searchInput" class="search-box" placeholder="Search part..." oninput="load()">

        <table>
            <thead>
                <tr>
                    <th>Part</th>
                    <th>Description (preview)</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="tbody"></tbody>
        </table>
    </div>

    <script>
        const API = "/api/CFACal/PartDescription";

        async function load() {
            const q = document.getElementById("searchInput").value;
            const res = await fetch(API + (q ? "?part=" + encodeURIComponent(q) : ""));
            const data = await res.json();

            const tbody = document.getElementById("tbody");
            tbody.innerHTML = "";

            data.forEach(d => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                        <td>${d.part}</td>
                        <td class="muted">
                            ${d.description_Long
                        ? d.description_Long.substring(0, 60) + (d.description_Long.length > 60 ? "..." : "")
                        : ""}
                        </td>
                        <td class="actions">
                            <button class="btn-secondary" onclick="edit('${d.part}')">✏️</button>
                            <button class="btn-danger" onclick="del('${d.part}')">🗑</button>
                        </td>`;
                tbody.appendChild(tr);
            });
        }

        async function edit(part) {
            const res = await fetch(API + "/" + encodeURIComponent(part));
            const d = await res.json();

            partInput.value = d.part;
            descInput.value = d.description_Long;
            window.scrollTo({ top: 0, behavior: "smooth" });
        }

        async function save() {
            const payload = {
                part: partInput.value.trim(),
                description_Long: descInput.value
            };

            if (!payload.part) {
                alert("Part is required");
                return;
            }

            await fetch(API, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });

            alert("Saved successfully");
            clearForm();
            load();
        }

        async function del(part) {
            if (!confirm("Delete " + part + "?")) return;
            await fetch(API + "/" + encodeURIComponent(part), { method: "DELETE" });
            load();
        }

        function clearForm() {
            partInput.value = "";
            descInput.value = "";
        }

        load();
    </script>

</body>
</html>
